class TopicClassifier:
    def __init__(self):
        self.topics = {
            '咖啡品質': [
                # 基本品質詞彙
                '品質', '口感', '味道', '風味', '豆子', '咖啡', '回甘', '順口', '濃郁', '淡', '苦', '香醇', '濃縮',
                '生豆', '烘焙', '手沖', '義式', '美式', '拿鐵', '焦苦', '酸味', '果香', '花香', '醇厚', '年份',
                '產地', '水準', '萃取',
                # 台灣特有咖啡詞彙
                '單品', '精品豆', '淺焙', '中焙', '深焙', '微批次', '義式烘焙', 
                '手沖', '冰滴', '冷萃', '虹吸', '濾掛', '耳掛', '耳罩', '濾杯', '聰明杯',
                '酸甜', '苦澀', '微酸', '厚實', '醇厚', '層次', '餘韻', '尾韻',
                # 台灣飲料文化
                '半糖', '微糖', '無糖', '少冰', '去冰', '溫', '熱', '常溫',
                # 評價詞彙
                '好喝', '難喝', '好', '爽口', '順口', '甘', '嗆', '水', '稀', '淡而無味',
                # PTT用語
                '屌打', '屌', '強', '猛', '超越', '完勝', '秒殺', '神等級', '神等', '秒', '銷魂'
            ],
            '服務體驗': [
                # 基本服務詞彙
                '服務', '態度', '店員', '人員', '店長', '熱情', '貼心', '友善', '慢', '不理人', '專業', '耐心', '熱忱',
                '招呼', '建議', '推薦', '解說', '說明', '介紹', '親切', '禮貌', '笑容', '溝通', '應對', '協助',
                # 台灣特有服務詞彙
                '奧客', '刁民', '店霸', '臭臉', '白眼', '翻白眼', '高冷', '衝康', '酸民',
                '好感', '親切', '沒有笑容', 'Tone', '口氣', '甜美', '有禮貌', '三八', '八婆',
                '靠北', '靠腰', '沒素質', '服務生', '工讀生', '正妹', '型男', '店狗', '店貓',
                '客訴', '投訴', '跪舔', '白目', '機車', '奧客', '慣老闆', '老闆娘', '薪水小偷'
            ],
            '價格優惠': [
                # 基本價格詞彙
                '價格', '貴', '便宜', '划算', '值得', '便利', 'CP值', '優惠', '折扣', '活動', '性價比',
                '定價', '特價', '降價', '漲價', '超值', '花費', '成本', '預算', '促銷', '限時',
                # 台灣特有價格詞彙
                '小資', '銅板', '小朋友', '塊', '元', '台幣', '新台幣', 'NTD',
                '佛心', '心痛', '薪水', '發薪日', '月底', '吃土', '省錢', '凱子', '傻傻貢獻',
                '血拼', '逛街', '買起來', '敗家', '剁手', '荷包失血', '月光族', '卡奴', '賺很大',
                '賣血', '賺錢', '當盤子', '卡刷爆', '回饋', '集點', '集點卡', '集滿', '換購'
            ],
            '環境氛圍': [
                # 基本環境詞彙
                '環境', '空間', '座位', '店面', '裝潢', '衛生', '吵雜', '安靜', '燈光', '氣氛', '音樂', '舒適',
                '乾淨', '整潔', '採光', '通風', '溫度', '冷氣', '擺設', '裝置', '風格', '設計感', '氛圍',
                'wifi', '插座', '停車',
                # 台灣網美文化詞彙
                '網美', '網美店', '打卡', '打卡點', 'IG打卡', '拍照', '好拍', '好看', '拍起來', 
                '美照', '帥照', '網紅', '文青', '文青風', '文藝', '質感', '有FU', '有fu', '文青店',
                '北歐風', '工業風', '日式', '韓風', '美式', '復古', '小清新', '簡約', '極簡',
                '明亮', '燈光美', '採光好', '陽光', '夕陽', '夜景', '觀景', '視野', '景觀',
                '自修', '讀書', '工作', '念書', '寫作業', 'K書', '開會', '辦公'
            ],
            '品牌形象': [
                # 基本品牌詞彙
                '品牌', '形象', '知名度', '口碑', '名氣', '評價', '聲譽', '風評',
                '連鎖', '規模', '企業', '文化', '理念', '經營', '特色', '風格',
                '在地', '國際', '發展', '歷史', '傳統', '創新',
                # 視覺識別詞彙 - 增加權重
                'logo', 'logo', 'logo', '標誌', '標誌', '商標', '商標', '圖案', '標識', 
                '吉祥物', '吉祥物', '吉祥物', '姿勢', '姿勢', 
                '設計', '配色', '顏色', '字體', '符號', '識別', '視覺', '企業識別',
                # 其他品牌相關詞彙...
            ],
            '餐點選擇': [
                # 基本餐點詞彙
                '可頌', '蛋糕', '司康', '餐點', '甜點', '點心', '麵包', '輕食', '小食',
                '三明治', '鹹食', '沙拉', '套餐', '早餐', '下午茶', '菜單', '品項', '選擇',
                # 台灣特有餐點詞彙
                '肉桂捲', '千層蛋糕', '提拉米蘇', '舒芙蕾', '貝果', '瑪德蓮', '費南雪',
                '奶酥', '奶酥餅', '蔥蛋糕', '法式吐司', '手工餅乾', '牛角麵包', '泡芙',
                '鬆餅', '酥餅', '蛋塔', '水果塔', '生巧克力', '重乳酪', '起司', '乳酪',
                '吐司', '丹麥', '奶油捲', '肉鬆', '紅豆', '抹茶', '栗子', '地瓜', '烤布蕾'
            ],
            '服務效率': [
                # 基本效率詞彙
                '等太久', '超快', '出餐慢', '排隊', '等候', '快速', '拖延',
                '效率', '準時', '即時', '流程', '調度', '忙碌', '人手', '尖峰', '離峰',
                # 台灣相關詞彙
                '人龍', '排隊龍', '人山人海', '人擠人', '前面有幾個人', '等很久', '一下就好',
                '慢吞吞', '龜速', '光速', '閃電', '飛快', '蝸牛', '等到天荒地老', '等到花兒都謝了',
                '比喝咖啡的時間還久', '比泡麵還快', '催單', '催菜', '挫咧等', '候位', 
                '等位', '預約', '二次候位', '預計等候', '時間觀念', '誤點'
            ],
            '行銷活動': [
                # 基本行銷詞彙
                '優惠券', '折價券', '集點', '買一送一', '特價', '促銷', '限時', '會員', 'APP', '點數', 'CAMA pay',
                '信用卡', '行動支付', '電子支付', '活動時間', '限定', '快閃', '合作', '方案', '好康',
                '行銷', '宣傳', '廣告', '社群', 'IG', 'FB', '臉書', '網路', '曝光', '網紅', '直播',
                # 台灣特有行銷詞彙
                '搶購', '秒殺', '限量', '搶先', '首賣', '首發', '先行者', '排隊領', '線上', '實體',
                '振興', '刷卡', '支付', '街口', 'Line Pay', '悠遊卡', '信用卡', '聯名卡', '紅利',
                '禮遇', '生日', '壽星', '慶生', '周年', '週年', '節慶', '情人節', '聖誕節',
                '開幕', '慶開幕', '週年慶', '紀念日', '會員日'
            ],
            '便利可及': [
                '店數', '分店', '展店', '據點', '店面', '地點', '地理位置', '交通', '便利', '方便',
                '附近', '鄰近', '周邊', '周圍', '到處', '普及', '覆蓋', '密度', '廣布', '遍布',
                '少', '多', '不夠', '不足', '太少', '太多', '增加', '減少', '擴展', '收縮',
                '開店', '開幕', '關店', '歇業', '倒閉', '搬遷', '展點', '展店', '擴點', '拓點',
                '發展', '成長', '速度', '快', '慢', '緩慢', '迅速', '急速', '遲緩', '延遲',
                '策略', '佈局', '規劃', '計畫', '藍圖', '版圖', '市場', '占有率', '競爭'
            ]
        }

    def classify(self, text: str) -> str:
            if not text or not isinstance(text, str):
                return '其他'
                
            text = text.lower()
            found_topics = []
            topic_scores = {}  # 為每個主題計算匹配次數
            
            for topic, keywords in self.topics.items():
                # 計算每個關鍵詞的匹配次數
                matches = sum(1 for keyword in keywords if keyword in text)
                if matches > 0:
                    topic_scores[topic] = matches
            
            # 根據匹配次數排序主題
            sorted_topics = sorted(topic_scores.items(), key=lambda x: x[1], reverse=True)
            
            # 選取最相關的前三個主題（如果有的話）
            found_topics = [topic for topic, score in sorted_topics[:3] if score >= 1]
            
            return '、'.join(found_topics) if found_topics else '其他'